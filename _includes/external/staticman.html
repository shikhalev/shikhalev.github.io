{% if page.comments != false %}

{% assign page_id = page.url | slugify %}

<!-- Comments -->
{% if site.data.comments[page_id] %}
  <section id="comments-section" style="display: block;">
{% else %}
  <section id="comments-section" style="display: none;">
{% endif %}
    <h2>Комментарии</h2>
    <small>Комментарии не проходят премодерацию, автор сайта не может нести ответственость за их содержание.</small>
    <table id="comments-table">
    {% if site.data.comments[page_id] %}
    {% assign comments = site.data.comments[page_id] | sort %}
    {% for comment in comments %}
      {% if comment[1].comment_id and comment[1].comment_id != '' %}
        {% assign coid = comment[1].comment_id %}
      {% else %}
        {% assign coid = comment[1]._id %}
      {% endif %}
      <tr>
        <td align="right" width="200px" valign="top">
        {% if comment[1].url and comment[1].url != '' %}
          <a href="{{ comment[1].url }}">
        {% endif %}
        <strong id="{{ coid }}">{{ comment[1].name }}</strong>
        {% if comment[1].url and comment[1].url != '' %}
          </a>
        {% endif %}
        <p class="post-meta" style="text-align: right;">{{ comment[1].date | date: "%Y.%m.%d %H.%M.%S" }}</p>
        </td>
        <td valign="top">
          {{ comment[1].message | xml_escape | markdownify }}
        </td>
      </tr>
    {% endfor %}
    {% endif %}
    </table>
  </section>

<!-- Comments Form -->
<div class="add-comment-section">
  <h3>Добавить комментарий</h3>
  <form method="POST" action="{{ site.staticman_url }}">
    {%- assign comment_id = "now" | date: "%N" -%}
    <input name="options[redirect]" type="hidden" value="{{page.url | absolute_url}}#{{ comment_id }}">
    <input id="slug" name="options[slug]" type="hidden" value="{{ page_id }}">
    <input name="fields[slug]" type="hidden" value="{{ page_id}}">
    <input name="fields[comment_id]" type="hidden" value="{{ comment_id }}">
    <input name="fields[parent_id]" type="hidden" value="">
      <div>
        <table align="left">
          <tr>
            <td align="right" width="200px"><label for="comment_name" style="font-weight: bold;">Имя:</label></td>
            <td><input id="comment_name" name="fields[name]" type="text"></td>
          </tr>
          <tr>
            <td align="right"><label for="comment_email">E-mail (необязательно):</label></td>
            <td><input id="comment_email" name="fields[email]" type="email"></td>
          </tr>
          <tr>
            <td align="right"><label for="comment_site">Сайт (необязательно):</label></td>
            <td><input id="comment_site" name="fields[url]" type="url"></td>
          </tr>
          <tr>
            <td align="right" valign="top">
              <label for="comment_message" style="font-weight: bold;">Сообщение:</label>
              <p style="font-size: small; text-align: right; hyphens: manual;">В тексте комментария можно использовать markdown-разметку,
                например, <span style="font-style: italic">*курсив*</span> или <span style="font-weight: bold;">**полужирный**</span>.
                HTML-разметку использовать нельзя.</p>
            </td>
            <td><textarea id="comment_message" style="width:100%" name="fields[message]" rows="12"></textarea></td>
          </tr>
          <tr>
            <td colspan="2">
      <div style="float: right; margin-left: 10px;">
      <div class="g-recaptcha" data-sitekey="6Ld9L3IaAAAAACZDaeBKKiL35iyzoTtTA0OlAv4C"></div>
      <button type="submit" style="height: 78px; vertical-align: top;">Отправить</button>
      </div>
      <p style="font-size: small; text-align: left; hyphens: manual;">Комментарии появляются на сайте с задержкой, если ваш комментарий не виден, попробуйте обновить страницу через минуту-другую.</p>
      <p style="font-size: small; text-align: left; hyphens: manual;">В случае каких-то проблем с reCAPTCHA, пожалуйста, напишите мне на <a href="mailto:shikhalev@gmail.com">shikhalev@gmail.com</a>.</p>
            </td>
          </tr>
        </table>
      </div>
      <input type="hidden" name="options[reCaptcha][siteKey]" value="6Ld9L3IaAAAAACZDaeBKKiL35iyzoTtTA0OlAv4C">
      <input type="hidden" name="options[reCaptcha][secret]" value="HCMKZ36nsLtl0ppFxIaaupVsykrGzEmwqrYBl8KwiCCHOoKtH8Kx272sbCuEzFjQmOrnZtfBLXrsk8HpgiRiqM17PvY3zIfSnqINMAtDzdrLMefyU5KwA8hXVF1DH5Qh7AFg/+MFw3BgQ+p7awlwm4K0vcjjsflRXF5NzpUnqyrSqBH++UltkKc1CN0/xETMzECLfNUysXDI4rtXkpHHox+Sha9scF/e+i8vl/cW5d6vjqbo/ojFui4WVf1izKINA2fQs/fzomBWzBkOmTc0xVrLs54uRLibE6Xw/gkmpEGtN7askwVYJXZaYPDhuPULzslunqudU+TjmhCDENfKEw==">
  </form>
<script src='https://www.google.com/recaptcha/api.js'></script>
</div>

<!-- <div id="splash" style="position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(127,127,127,0.5); display: none;">
<div style="position: absolute; left: 50%; top: 50%; width: 200px; margin-left: -100px; height: 70px; padding: 5px; margin-top: -35px; background-color: white;">
  <img src="/assets/img/loader.gif" style="float: left; margin-right: 5px; margin-top: 2px;">
  Пытаемся проверить комментарии...</div>
</div>

<script src="/assets/js/comment-loader.js" type="text/javascript"></script> -->

{% endif %}
