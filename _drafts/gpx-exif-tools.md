---
title: Как я ставлю геометки к фотографиям
description: Запись GPX и корректная его обработка
category:
  - photo
  - processing
  - tech
  - soft
tags:
  - GPX
  - EXIF
  - exiftool
  - Darktable
  - GPXLab
  - карты
  - HOWTO
---
{% include image.liquid place="right" width=200 src="/assets/img/2021-07/gpx/locus-map.jpg" title="Скриншот Locus Map" %}

## Получение трека

Фотокамера у меня недорогая, и GPS в ней, конечно, нет. Зато есть в телефоне. Поэтому треки я записываю приложением
**[Locus<span> Map Free</span>][locus]{:.img-icon-locus-map}** (не Pro) — большую часть его возможностей (даже бесплатной
версии) я не использую, но треки пи­шет хорошо, меня устраивает. И, кста­ти, весьма скромно использует батарею.

*Перед выходом*, сразу после проверки заряда во всех устройствах и места на флешке, *крайне желательно убедиться, что время
на телефоне и в ка­ме­ре — одинаковое*. Конечно, при пешем передвижении минутная разница не так существенна, но однажды у меня
камера отстала на пять минут, и результаты были для меня несколько внезапны.

Что еще важно для записи трека: дать приложению нужные разрешения *для всех режимов* — не хо­дить же с постоянно включенным
экраном, на котором оно распахнуто. То есть, доступ к мес­то­по­ло­же­нию должен быть «Разрешить в лю­бом режиме», и «Кон­т­роль
активности» — «Нет ограничений», при ре­ко­мен­до­ван­ном «Умном режиме» нормального трека получить не удас­т­ся. Что хо­ро­шо —
Locus Map проверяет эти разрешения и выдает подсказку, если они не ус­та­нов­ле­ны, не ис­клю­че­но, что именно отсутствие такой
подсказки и не позволило мне подружиться с другими приложениями для записи треков.

Трек пишется в GPX-файл, и это хорошо, поскольку данный формат понимают если не все, то очень многие программы, с ко­то­ры­ми
нужно взаимодействовать. Я его отправляю прямо из при­ло­же­ния кнопкой шаринга «<span class="fas">&#xf1e0;</span>»,
из предлагаемых вариантов выбирая **[KDE<span> Con­nect</span>][konnect]{:.img-icon-kdeconnect}** — архиполезная вещь, хоть
и глюч­ная (впрочем, каким путем передать файл на компьютер — непринципиально).

<!--more-->

## Подготовка файла трека

Итак, у нас есть GPX-файл со все­ми перемещениями. Необязательно полученный именно с телефона, и имен­но так, как я изложил
выше — подойдет любой источник, глав­ное — часы синхронизировать.

{% include image.liquid place="center" width=800 src="/assets/img/2021-07/gpx/gpxlab.png" title="Главное окно GPXLab" %}

Теперь нужно почистить трек: GPS — штука тонкая, и слу­ча­ют­ся вылеты типа показанного на скрин­шо­те — там аж несколько точек,
образующих «треугольную» петлю, явно лажовые. Вообще, существуют программы, ищущие и вы­чи­ща­ю­щие такие точки автоматически
(например, **[GPSBabel][babel]{:.img-icon-gpsbabel}**),
но мне проще глазами посмотреть и руками удалить. Для этой цели хорошо подходит **[GPXLab][lab]{:.img-icon-gpxlab}**.
Можно ориентироваться прямо по карте, можно просмотреть список точек справа внизу, обращая внимание на не­су­раз­ные значения шага
и ско­рос­ти — ну, не мог я передвигаться пешком по ле­су со ско­рос­тью почти 80 км/ч... Такие точки просто удаляем. Можно еще
обратить внимание на слиш­ком резкие перепады высот (верхний правый угол) и вычистить их тоже.




[locus]: https://www.locusmap.app/
[konnect]: https://kdeconnect.kde.org/
[lab]: https://github.com/BourgeoisLab/GPXLab
[babel]: https://www.gpsbabel.org/

*[GPX]: GPS eXchange Format
*[GPS]: Global Positioning System
