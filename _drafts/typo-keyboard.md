---
layout: post
title: Ввод «типографских» символов с клавиатуры (ed. 2021)
description: >-
  Настройка клавиатуры в Linux для ввода различных символов, таких как, например, длинное тире,
  кавычки-ёлочки, знак копирайта и так далее. В редакции 2021 года.
category: [ tech, soft ]
tags:
  - Linux
  - клавиатура
  - символы
  - KDE
  - GNOME
  - Xfce
comments: false
---
<div class="right-box" style="width: 320px">
[![Раскладка клавиатуры с третьим и четвертым уровнями][layout]][layout]
</div>

{:.note.italic}
Оригинал этого поста в «Технобложике» оказался самым популярным материалом — на него заходят и заходят
из поисковиков, ссылаются на форумах и так далее. Поэтому к его переносу я подошел максимально ответственно,
перепроверив все рекомендации в современных дистрибутивах и внеся дополнения. Таким образом, этот пост
получил некоторую добавочную ценность к оригиналу. Хотя каких-то принципиальных изменений не случилось,
только уточнение деталей и актуализация.

На эту тему в интернетах написано немало. Я лишь хочу в этом посте собрать и обобщить некоторую часть информации,
чтобы рекомендовать друзьям – новичкам в Linux. Итак, этот пост для тех, кто работает с текстом в Linux, дабы они
поняли свое счастье.

Вообще говоря, ввод каких бы то ни было символов с клавиатуры можно организовать разными путями, некоторые
из которых (например, определение собственной раскладки) доступны и в оффтопичной системе от MS. Однако, *удобных*
способов существенно меньше. Собственно, я буду говорить о двух, простых как в использовании, так и в настройке:
«третий уровень» и Compose Key.

## Общие принципы

«Третий уровень»

: Это как бы дополнительный `[Shift]` — добавочный ряд символов на клавишах: нажимаете назначенную для этого клавишу
  вместе с какой-то алфавитно-цифровой и получаете специальный символ. Руки очень быстро «запоминают» такое сочетание.
  Использовать не сложнее, чем `[Shift]` оригинальный, разве что у того клавиши широкие на большинстве клавиатур...
  Причем можно зажать и назначенную нами клавишу третьего уровня (в дальнейшем — `[L3]`) и `[Shift]`, получив тем
  самым «четвертый уровень»... Но вряд ли это особо понадобится.

  Пример: длинное тире («—») вводится как `[L3]+[-]`.

Compose Key

: Тут принцип другой — нажимаете (и отпускаете) назначенную для этого клавишу, затем нажимаете последовательно несколько
  (две–три обычно) алфавитно-цифровых клавиш, чтобы получить их «сочетание». Например, значок копирайта («©») можно ввести
  так: `[Compose]→[o]→[c]` (а можно — `[Compose]→[c]→[o]`). Здесь я стрелочками подчеркиваю, что клавиши нажимаются
  последовательно, а не одновременно. Кстати, сами стрелочки я ввожу посредством `[Compose]→[-]→[>]`.

  {:.small.italic}
  Уточнение от 2021 года. Умолчательные сочетания клавиш могут различаться от дистрибутива к дистрибутиву и от версии
  к версии. Сейчас у меня сочетание `[Compose]→[o]→[c]` действительно выдает значок копирайта, но вот
  `[Compose]→[c]→[o]` — уже другой символ — «ǒ». Кроме того, стрелочку вправо я сейчас предпочитаю вводить через
  третий уровень — `[L3]+[0]`, хотя вариант через Compose также рабочий.

Эти два способа совершенно друг другу не мешают. Лично я их использую оба, применяя Compose Key для тех символов, которые
отсутствуют в наборе «третьего уровня».

## Базовая настройка

### KDE 4 и 5

<div class="right-box" style="width: 320px">
[!["Модуль настройки клавиатуры в KDE"][kde]][kde]
</div>

У меня стоит версия KDE 4.5.4, в других версиях названия каких-то пунктов могут отличаться, но вряд ли существенно.

{:.note.italic}
Год 2021. Использую KDE 5, версия Plasma — 5.21.3, KDE Applications — 20.12.3. В отношении настройки клавиатуры по сути ничего
не поменялось — см. [иллюстрацию][kde].

Итак, открываем «Параметры системы» и находим там раздел «Об&shy;о&shy;ру&shy;до&shy;ва&shy;ние» → «Устройства ввода» → «Клавиатура». Открываем вкладку
«До&shy;пол&shy;ни&shy;тель&shy;но». Если попалась непереведенная версия, по-английски это будет «System Set&shy;tings» → «Hardware» → «Input Devices» →
«Keyboard» → «Advanced». Там следует отметить (если еще не отмечена) галочку «Настроить параметры клавиатуры» («Configure
keyboard options»), после чего станут доступны собственно настройки. Нам понадобятся следующие:

* «Клавиша для выбора 3-го ряда» («Key to choose 3rd level») — нужно отметить один из вариантов. Лично я использую клавиши `[Win]`
  (те, на которых нарисован флажок MS), поскольку: а) их две, а мы помним, что настраиваем как бы дополнительный `[Shift]` — тоже парный;
  б) по-умолчанию никакой полезной нагрузки в Linux они не несут, соответственно, ничего нужного мы таким образом не испортим. В общем,
  мой выбор — «Любая клавиша Win» («Any Win key»).

  {:.small.italic}
  Сейчас у меня клавиатура с закосом под игровую, и справа вместо `[Win]` — ненужная мне `[Fn]`, на которую, увы, ничего не настроить.
  Поэтому в дополнение к вышесказанному отметил еще и правый `[Alt]` — все-таки очень привык к `L3` с обеих сторон.

* «Разные параметры совместимости» → «Включить дополнительные типографские символы» («Miscellaneous compatibility options» → «Enable extra
  typographic characters»). Этим мы собственно «заполняем» подключенный предыдущим пунктом «третий уровень».

* «Клавиша пробела используется для ввода символа неразрывного пробела» → «Символ неразрывного пробела в третьем ряду,
  символ тонкого неразрывного пробела в четвёртом ряду» («Using space key to input non-breakable space character» →
  «Non-breakable space character at third level, thin non-breakable space character at fourth level»). Пробел, на котором
  запрещен разрыв строки принято использовать, например, после инициалов, а также перед тире. Установка данной опции позволит
  вводить его быстро и логично. Что же до тонкого неразрывного пробела... Использовать его не обязательно, однако по-хорошему
  для инициалов должен использоваться именно он. Сравним: «Ф. М. Достоевский» и «Ф. М. Достоевский» (не говоря уж об кошмарном,
  но часто используемом, варианте «Ф.М. Достоевский»). Еще его можно использовать между запятой/точкой и тире. Правда, эффект
  сильно зависит от шрифта, причем в шрифте может вообще не оказаться такого символа и мы получим на его месте знак вопроса
  или квадратик... Хотя в последнее время все шрифты (с которыми мне доводилось иметь дело) содержат подобные символы.

* «Положение клавиши Compose» («Compose key position»). Лично я в качестве `[Compose]` использую `[Caps Lock]`, поскольку
  ее штатное действие приносит исключительно вред. Если же вы не можете от нее отказаться, можно выбрать столь же бесполезную
  (однако, безвредную) `[Scroll Lock]`, хотя на мой взгляд, ее расположение не столь удобно.

Итого — нам понадобилось поставить четыре галочки.

### GNOME и Cinnamon

<div class="right-box" style="width:320px">
[![Настройка клавиатуры в Ubuntu][ubuntu]][ubuntu]
</div>

В GNOME есть (должен быть) подобный модуль центра управления для настройки клавиатуры. Ввиду эстетического неприятия, сейчас GNOME
на моем компьютере отсутствует, а ставить его только ради того, чтобы посмотреть, как там настраивается раскладка клавиатуры — это уж
слишком. Ищите по ключевым словам «третий уровень», «типографские символы» и «Compose Key»...

<div class="note italic">
На этот раз я не поленился и посмотрел разные дистрибутивы и DE в виртуалках.
</div>

<div class="left-box" style="width: 320px">
[![Настройка клавиатуры в среде Cinnamon (Linux Mint)][cinnamon]][cinnamon]
</div>

<div class="note italic">
GNOME не подвел — «из коробки» там ничего нет, чтобы получить третий уровень и Compose, нужно ставить GNO&shy;ME Tweak Tool. Впрочем,
как я понимаю, это нужно практически для всего. Еще интересный момент, что настройка Compose Key («композиционной клавиши») вынесена
на первый экран настроек клавиатуры (см. скриншот справа), тогда как третий уровень нужно задавать в диалоговом окне, открывающемся
по кнопке «Дополнительные параметры раскладки».

А вот Cinnamon держит настройки вместе. И место это «Параметры системы» → «Клавиатура» → «Раскладки» → кнопка «Параметры...» — см. скриншот слева.

В общем-то, не проблема найти, все логично.
Галочки в списках в обеих системах те же самые, что и вышеописанные KDE-шные, так что см. предыдущий пункт.
</div>

### Xfce и все-все-все...

<div class="right-box" style="width: 240px">
[![Настройки клавиатуры в среде Xfce][xfce]][xfce]
</div>

Почему «и все-все-все...»? Потому что Xfce не умеет настраивать подобные средства — его возможности настройки клавиатуры
сильно ограничены... Поэтому сейчас мы рассмотрим универсальный для всех иксов способ настройки — через конфиги. Способ
именно что универсальный — у меня и KDE работает с заданными таким образом системными настройками, однако для его использования
нужно иметь доступ от root'а, да и конфиги править — это вам не галочки мышкой щелкать — это гораздо проще.

{:.note.italic}
Что ж, вот и хорошие новости: за прошедшие 10 лет Xfce таки расширил возможности настройки клавиатуры. Частично. Теперь можно
штатным средствами включить Compose Key, см. скриншот. А вот доступа к третьему уровню не прибавилось, таким образом настоящий
раздел актуальности не утратил.

Тут есть только одна загвоздка — расположение нужных настроек зависит от версии сервера иксов...

Как это выглядит у меня: отдельный файл `/etc/X11/xorg.conf.d/20-keyboard.conf` содержит следующее:

{% highlight conf %}
Section "InputClass"
  Identifier "Keyboard Defaults"
  MatchIsKeyboard "yes"
  Option "XkbLayout" "us,ru"
  Option "XkbOptions" "grp:alt_shift_toggle,grp_led:scroll,compose:caps,lv3:win_switch,nbsp:level3n,misc:typo"
EndSection
{% endhighlight %}

Эту секцию можно и просто вписать в файл `/etc/X11/xorg.conf`. Однако есть вероятность того, что это не сработает —
на старых версиях Xorg, насколько я помню, устройства по классам не фильтровались... В общем, если не получилось так,
то нужно отыскать в `/etc/X11/xorg.conf` строку `Option "XkbOptions"` и изменить ее значение на вышеуказанное.
Если же xorg-server работает с клавиатурой через HAL, то ему следует скормить файл `/etc/hal/fdi/policy/10-x11-input.fdi`,
о котором я уже писал когда-то, добавив туда «`lv3:win_switch,nbsp:level3n,misc:typo`» в опции.

<!-- TODO: ссылка на пост про HAL и .fdi -->

Кроме указания всех этих опций так или иначе в параметрах X-сервера, придется их еще и активировать программой `setxkbmap`
(без каких-либо ключей или параметров). В Xfce ее просто нужно задать в автозапуск.

<div class="note italic">
И снова хорошие новости: ни в Xfce (по крайней мере в Xubuntu), ни в LXQt (Lubuntu соответственно), больше не надо ничего
прописывать в автозапуск — в Xfce следует отметить флажок «Использовать системные параметры», ну а LXQt и вовсе ничего такого
настраивать не умеет, и использует настройки Xorg без каких-либо флажков (точнее, не мешает их использовать).

Еще в Lubuntu обнаружился один момент — там окружение перехватывает клавишу `[Win]` и обрабатывает ее в духе Windows.
На третий уровень, получается, эти клавиши назначить нельзя. Но сам третий уровень работает, например, если назначить
правый `[Alt]`, или еще какую-нибудь клавишу, которую не жалко.
</div>

## Использование

Собственно, как этим пользоваться, я написал в самом начале. Ниже подробности — как ввести наиболее часто нужные символы.

### Третий уровень

<div class="note italic">
Вместо старой таблицы я наконец-то сделал красивую схему клавиатуры с третьим и четвертым уровнями. Самому такую памятку
давно хотелось, да все как-то руки не доходили. На <u>небуквенных</u> клавишах в верхней части слева — простое нажатие,
справа — с `[Shift]`, на <u>буквенных</u> — собственно буква в верхнем регистре, как обычно на самой клавиатуре изображается.
Нижний ряд везде (где оно есть): слева — третий уровень, т.е. при зажатой клавише `[L3]`, справа — четвертый, т.е.
`[Shift]+[L3]`. Желающие распечатать в максивальном качестве могут скачать [архив с SVG][zip].

Как я уже говорил, что-то может меняться от дистрибутива к дистрибутиву и от версии к версии. Сейчас у меня схема именно такая,
от текущей раскладки (rus/eng) она не зависит.
</div>

<div class="center-box" style="max-width: 880px">
[!["Раскладка клавиатуры с третьим и четвертым уровнями"][layout]][layout]
</div>

{:.note}
Некоторые символы, пожалуй, требуют пояснений, их-то я и вынесу в таблицу:

{:.coded}
|  Сочетание         | Сим. | Unicode               | Комментарий |
|:-------------------|:----:|:----------------------|:------------|
| `[L3]+[-]`         | `—`  | `U+2014 EM DASH`      | Длинное тире — собственно тире в русской пунктуации. |
| `[L3]+[Shift]+[-]` | `–`  | `U+2013 EN DASH`      | Короткое тире — в классической русской пунктуации не использовалось. Сейчас начинает применяться для диапазонов. |
| `[L3]+[P]`         | `´`  | `U+00B4 ACUTE ACCENT` | Это просто символ, не путать с `U-0301`, он же `[L3]+[A]`. |
| `[L3]+[Shift]+[P]` | `˝`  | `U+02DD DOUBLE ACUTE ACCENT`    | |
| `[L3]+[A]`         | _́    | `U+0301 COMBINING ACUTE ACCENT` | Знак ударе́ния. Ставится *над предыдущим символом*, а не на отдельное знакоместо. |
| `[L3]+[D]`         | `°`  | `U+00B0 DEGREE SIGN`  | Знак градуса — на картинке это может быть не очень заметно, но размещается в верхней части строки. «Сегодня -5°C», например. |
| `[L3]+[J]`<br>`[L3]+[Shift]+[J]`<br>`[L3]+[K]`<br>`[L3]+[Shift]+[K]`<br>`[L3]+[L]`<br>`[L3]+[Shift]+[L]`  | `„`<br>`‚`<br>`“`<br>`‘`<br>`”`<br>`’` | `U+201E DOUBLE LOW-9 QUOTATION MARK`<br>`U+201A SINGLE LOW-9 QUOTATION MARK`<br>`U+201C LEFT DOUBLE QUOTATION MARK`<br>`U+2018 LEFT SINGLE QUOTATION MARK`<br>`U+201D RIGHT DOUBLE QUOTATION MARK`<br>`U+2019 RIGHT SINGLE QUOTATION MARK` | Это *правильные* символы кавычек-лапок, двойных и ординарных. Причем сочетание, соответствующее J-K, принято в русской пунктуации, а K-L — в английской (то есть русская закрывающая кавычка является английской открывающей). |
| `[L3]+[;]`<br>`[L3]+[']` | `‘`<br>`’` | `U+2018 LEFT SINGLE QUOTATION MARK`<br>`U+2019 RIGHT SINGLE QUOTATION MARK` | Да-да, дублируют символы из предыдущего блока, только на третьем уровне, а не на четвертом[^check]. |
| `[L3]+[Shift]+[;]` | `′` | `U+2032 PRIME` | Используется для обозначения угловых минут и футов[^feet]. |
| `[L3]+[Shift]+[']` | `″` | `U+2033 DOUBLE PRIME` | Используется для обозначения угловых секунд и дюймов. |
| `[L3]+[Shift]+[X]` | `⋅` | `U+22C5 DOT OPERATOR` | Это математический символ. Для умножения в формулах предпочтительно с позиций типографики использовать именно его, а не обычную звездочку или какую-то из множества центральных точек. |
| `[L3]+[M]`         | `−` | `U+2212 MINUS SIGN` | Знак минуса. Математический опять же. В отличие от обычного дефиса, к которому все привыкли, этот знак в шрифтах *должен* по высоте, ширине и толщине соответствовать знаку плюса. |
| `[L3]+[Shift]+[M]` | `•` | `U+2022 BULLET` | А этот символ в противоположность `U+22C5` не нужно использовать в математических формулах, а предназначен он для списков и прочего как маркер. |
|===
| `[L3]+[ ]` | ` ` | `U+00A0 NO-BREAK SPACE` | Неразрывный пробел. |
| `[L3]+[Shift]+[ ]` | ` ` | `U+202F NARROW NO-BREAK SPACE` | Тонкий неразрывный пробел. |

{:.note.italic}
Проверяя последний пункт, обнаружил баг в своей системе, но об этом позже.

### Compose Key

Тут вообще уйма разных сочетаний, я приведу только наиболее (на мой взгляд) полезные и не встречающиеся в предыдущей таблице.

{:.coded}
| Сочетание               | Сим. | Unicode | Комментарий |
|:------------------------|:----:|:--------|:------------|
| `[Compose]→[^]→[1]`     | `¹`  | `U+00B9 SUPERSCRIPT ONE` | Верхний индекс — так же работает для всех цифр, скобок, плюса, минуса и равно. |
| `[Compose]→[_]→[1]`     | `₁`  | `U+2081 SUBSCRIPT ONE`   | Нижний индекс — аналогично предыдущему. |
| `[Compose]→[(]→[1]→[)]` | `①`  | `U+2460 CIRCLED DIGIT ONE` | Цифра в кружочке — для всех цифр работает. |
| `[Compose]→["]→[a]`     | `ä`  | `U+00E4 LATIN SMALL LETTER A WITH DIAERESIS` | Для всех гласных латиницы. |
| `[Compose]→[']→[a]`     | `á`  | `U+00E1 LATIN SMALL LETTER A WITH ACUTE`     | Аналогично предыдущему. |
| `[Compose]→[s]→[s]`     | `ß`  | `U+00DF LATIN SMALL LETTER SHARP S`          | Заглавный эсцет тоже есть — из заглавных S соответственно. |
| `[Compose]→[#]→[b]`     | `♭`  | `U+266D MUSIC FLAT SIGN` | |
| `[Compose]→[#]→[f]`     | `♮`  | `U+266E MUSIC NATURAL SIGN` | |
| `[Compose]→[#]→[#]`     | `♯`  | `U+266F MUSIC SHARP SIGN` | |
| `[Compose]→[P]→[P]`     | `¶`  | `U+00B6 PILCROW SIGN` | Он же «paragraph sign». |
| `[Compose]→[a]→[e]`     | `æ`  | `U+00E6 LATIN SMALL LETTER AE` | Аналогично для заглавных. Так же работает для некоторых распространенных лигатур, например `ﬀ`, но не для всех. |
| `[Compose]→[:]→[)]`     | `☺`  | `U+263A WHITE SMILING FACE`  | |
| `[Compose]→[:]→[(]`     | `☹`  | `U+2639 WHITE FROWNING FACE` | |
| `[Compose]→[<]→[3]`     | `♥`  | `U+2665 BLACK HEART SUIT` | |
| `[Compose]→[N]→[o]`     | `№`  | `U+2116 NUMERO SIGN` | Если вдруг нет русской раскладки, а знак номера очень хочется... |
| `[Compose]→[o]→[x]`     | `¤`  | `U+00A4 CURRENCY SIGN` | |
| `[Compose]→[s]→[m]`     | `℠`  | `U+2120 SERVICE MARK` | |
| `[Compose]→[<]→[=]`<br>`[Compose]→[>]→[=]` | `≤`<br>`≥`  | `U+2264 LESS-THAN OR EQUAL TO`<br>`U+2265 GREATER-THAN OR EQUAL TO` | Вид нижней черты — горизонтальная или наклонная — зависит от шрифта. |




[^check]: Символы я определял, естественно не на глаз, а вводя в поле KCharSelect, так что в дублировании уверен.
[^feet]: Информация про футы из KCharSelect, вживую я такого обозначения не встречал.

[layout]: /assets/img/2021-03/typo/keyboard-layout.png "Раскладка клавиатуры с третьим и четвертым уровнями"
[zip]: /assets/img/2021-03/typo/keyboard-layout.svg.zip "Архив с SVG-файлом раскладки"
[kde]: /assets/img/2021-03/typo/kde.png "Модуль настройки клавиатуры в KDE"
[ubuntu]: /assets/img/2021-03/typo/ubuntu.png "Настройка клавиатуры в Ubuntu"
[cinnamon]: /assets/img/2021-03/typo/cinnamon.png "Настройка клавиатуры в среде Cinnamon (Linux Mint"
[xfce]: /assets/img/2021-03/typo/xfce.png "Настройки клавиатуры в среде Xfce"
