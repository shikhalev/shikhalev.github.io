---
title: Возвращаясь к размышлизму...
description: Или снова об оптимизации скриптовых языков.
category: [ tech, programming, abs ]
tags:
  - оптимизация
  - языки программирования
  - скриптовые языки
  - размышлизмы
recommend: true
---
Или снова об оптимизации скриптовых языков. В [предыдущей заметке][pred] я это всё как-то сумбурно описал.
Вкратце: для условного веб-сервиса минута инициализации много «дешевле», чем секунда обработки запроса.
Поэтому, проведя собственно инициализацию, имеет смысл оптимизировать с ее учетом дальнейшую работу.
И для скриптовых языков это вполне возможно, в отличие от компилируемых. А вот как это мне представляется в плане практики:

* Составляем граф переходов для загруженной программы. Естественно, учитываем на данном этапе все возможные переходы.

* Выделяем самый внешние (т.е. не вложенные ни в какие другие) циклы. Получаем точки-входы и точки перед ними,
  в которые гарантированно не происходит возврата.

  {:.note.italic}
  По идее, нам надо выделить самый главный цикл, а циклы в инициализации и финализации нас уже не интересуют.
  Скорее всего, его таки можно выделить, но в общем случае — проблематично.

* Когда исполнение доходит до такой точки невозврата, включаем оптимизацию дальнейшего кода:

  * Находим переменные, значения которых в данном цикле не меняются, фиксируем их как константы, вычисляем все константные выражения.
  * Просматриваем условные ветвления в графе переходов, сокращаем те, условия которых стали константами в силу предыдущего пункта.
  * Поскольку в отброшенных путях могли быть изменения переменных, повторяем итерацию. Пока изменения не закончатся.
  * Только теперь с чистой совестью запускаем цикл.

Естественно, это всё не отменяет классической алгоритмической оптимизации, JIT-компиляции и т.д. после сокращения всего ненужного.
И естественно, всё это не будет работать при «`eval(string)`» внутри циклов, но так делать в любом случае не стоит...

[pred]: {% link _posts/tech/2013/2013-05-17-eval-vs-exec.md %} "Об оптимизациях скриптовых языков..."
