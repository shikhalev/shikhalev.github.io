---
title: "Пингвин-фотолюбитель: 3. Панорамы"
category: [ photo, processing, penguin, tech, soft, graphics ]
tags:
  - панорамы
  - Hugin
  - Linux

description: Склейка панорам под Linux — программа Hugin
image: /assets/img/2016-06/p-03/IMG_1868.jpg
recommend: true
---
{% include nova/image.html place="right" width=240 src="/assets/img/2016-06/p-03/IMG_1868.jpg" link=false%}

Для склеивания панорам нам понадобится программа с гордым именем **[Hugin][hugin]{:.img-icon-hugin}**. Имя действительно гордое,
ибо дано в честь Хугина — одного из воронов Одина.

На КДПВ, конечно, не сам Хугин, а некий современный его сородич. Будем считать, потомок.

Устанавливать программу я рекомендую опять же свежую версию из PPA — «`ppa:​hugin/​hugin-builds`». На момент написания
поста актуальна версия 2016.0.0.

<div class="note">
*Вообще-то, тут у меня накладочка — Hugin отказался заводиться на виртуалке, как свежий, так и из основного
репозитория. Судя по всему, ему не хватило драйверов видеокарты. Так что гарантировать, что свежая версия
работает под Linux Mint лучше старой, я не могу. Скрины будут с моей основной системы, т.е. Gentoo.*
</div>

Raw-файлы Hugin, к сожалению, читать не умеет, поэтому склеивать будем из 16-битного TIFF, [предварительно
полученного посредством Darktable][raw].

<!--more-->

Я для примера отснял приблизительно такие файлы:

{% include nova/image.html place="center" width=700 src="/assets/img/2016-06/p-03/frames.jpg" class="logo" %}

Разумеется, в обработку пойдут полноразмерные TIFF-версии.

Первым делом я бы советовал выбрать простой интерфейс. Для простых задач он оптимален, а сложные... Если вы
готовы склеивать панораму, которую Hugin счел непростой, непонятно, зачем вы это читаете...

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/hugin-simple.png" %}

Кнопки вверху как бы говорят нам, что потребуется три шага: загрузить, выровнять и сформировать панораму.
На самом деле все не так просто (совсем чуть-чуть сложнее), и вкладки (еще выше) не бесполезны.

Первым делом, да — загружаем снимки:

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/hugin-loaded.jpg" %}

Затем нажимаем «Выровнять», после чего откроется окошко с процессом обработки, которое я на *данном* примере
банально не успеваю соскриншотить. Если клеить панораму из большого количества кадров, эта обработка — собственно
поиск совпадений и стыковок — займет уже существенное время. А в итоге мы получим что-то такое:

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/hugin-first.jpg" %}

То есть, кадры-то состыкованы, но на виртуальной сфере и нам дана «не пойми какая» проекция. Почему так происходит?
Да потому, что исходные кадры сняты с рук, а не посредством специальной панорамной штативной головки. Плюс дисторсия,
частично скомпенсированная объективом... В общем, перейти к финальному шагу мы пока не можем. А делаем вот что:
идем на вкладку «Сдвиг/смещение» и нажимаем «Выпрямить». Получаем уже нечто приличное:

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/hugin-3d.jpg" %}

Затем на вкладку «Обрезка» и кадрируем, как душе будет угодно. Впрочем, я бы советовал нажать «Автообрезка»
и не заморачиваться.

Вот теперь мы можем спокойно вернуться на вкладку «Ассистент» и нажать «Создать панораму», нас спросят
о выходном формате:

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/hugin-fin-1.png" %}

Неактивные на моих скринах варианты со сведением экспозиций возникают, когда мы строим панораму из снимков
с разной экспозицией. Панорама и HDR в одном флаконе, так сказать. Размер выходного снимка я предпочитаю оставить
такой, какой Hugin выдает на автомате — из-за вышеупомянутой съемки с рук, дисторсии и т.д. пиксель-к-пикселю все
равно не получится.

Далее спросят имя для проекта и для выходного файла. Ну, и пойдет сборка.

<div class="image-box">
{% include nova/image.html place="inner" width=320 src="/assets/img/2016-06/p-03/hugin-batch.png" %}
{% include nova/image.html place="inner" width=320 src="/assets/img/2016-06/p-03/hugin-task.png" %}
</div>

Таких сборок можно запустить несколько и они встанут в очередь — левое окно. Правое окно демонстрирует ход процесса.
Ждем, курим, пьем чай. Опять же, на *этом* примере обработка проходит быстро, но на больших склейках... У меня, было
дело, <s>от этого брат умер</s> на этом этапе компьютер перегревался (причем не процессор, а северный мост). Я, конечно,
с тех пор охлаждение сильно улучшил, но вообще нагрузка изрядная.

В качестве финального штриха можно перенести в готовый файл EXIF из первого исходного (или не первого, неважно):

{%  highlight console %}
$ exiftool -tagsFromFile IMG_3192.tif pano.tif
{% endhighlight %}

В итоге как-то так, так как-то:

{% include nova/image.html place="center" width=800 src="/assets/img/2016-06/p-03/pano.jpg" %}

В целом, собирать панорамы под Linux оказалось намного проще, чем я думал. Правда, бывают и сложные случаи с какими-то
неочевидностями — чаще всего их легче переснять, но это не всегда возможно... Если что, пишите в комментарии, попробуем
вместе разобраться.

[kdpv]: /assets/img/2016-06/p-03/IMG_1868.jpg
[frames]: /assets/img/2016-06/p-03/frames.jpg
[simple]: /assets/img/2016-06/p-03/hugin-simple.png
[loaded]: /assets/img/2016-06/p-03/hugin-loaded.jpg
[first]: /assets/img/2016-06/p-03/hugin-first.jpg
[3d]: /assets/img/2016-06/p-03/hugin-3d.jpg
[fin-1]: /assets/img/2016-06/p-03/hugin-fin-1.png
[batch]: /assets/img/2016-06/p-03/hugin-batch.png
[task]: /assets/img/2016-06/p-03/hugin-task.png
[pano]: /assets/img/2016-06/p-03/pano.jpg

[hugin]: http://hugin.sourceforge.net/

[raw]: {% link _posts/photo/2016/2016-06-13-raw.md %}
