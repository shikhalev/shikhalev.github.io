---
title: Обработка фото наблюдений
description: Как стоит и как не стоит обрабатывать фотографии наблюдений живой природы
category:
  - photo
  - processing
  - birdwatching
  - nature
tags:
  - iNaturalist
  - Darktable
  - RAW
  - JPEG
image: _src/2023/07/26/00094-2752207474.png
seo_image_crop: "768x400+0+94"
recommend: true
---
{% image @_src/2023/07/26/00094-2752207474.png figure right width=400px title="Сгенерироованная нейросетью иллюстрация" %}

В последнее время я просмотрел довольно много всяких разных *чужих* наблюдений на **[iNa­tu­ra­list][inat]{:.img-icon-inaturalist}** и,
пожалуй, имею что сказать по по­во­ду фотографий. Не толь­ко нецензурного.

Понятно, что со сним­ка­ми далеких птиц на те­ле­фон сделать, в об­щем-то, ничего нельзя, разве что отметить малую вероятность успешной
идентификации при та­ком сетапе. Но сле­ду­ю­щая по по­пу­ляр­нос­ти проб­ле­ма — это съемка птиц на фоне не­ба или что-то подобное, т.е. вы­со­кий
общий контраст сцены и полная неразличимость интересующего нас объекта в те­нях[^obs]. И с ней что-то сделать уже можно.

Сразу скажу о допустимости обработки в це­лом. Возможно, для ко­го-то это будет новостью[^news], но *необработанных фотографий не бы­ва­ет*, данные,
которые считываются с мат­ри­цы — это не кар­тин­ка в JPEG, они в лю­бом случае требуют интерпретации и обработки по не­ко­то­рым алгоритмам.
Вопрос в том, бу­дет ли это автоматическая обработка внутри камеры (съемка в JPEG), или последующая уже подконтрольная пользователю обработка
RAW (те самые сырые данные с мат­ри­цы) на ком­пью­те­ре, так называемая «проявка». Так что не сто­ит размышлять о до­пус­ти­мос­ти/не­до­пус­ти­мос­ти
обработки вообще, стоит говорить о до­пус­ти­мос­ти/не­до­пус­ти­мос­ти *конкретных* методов и приемов обработки. О них и пойдет речь.

Итак, тем, кто снимает на те­ле­фон или дешевую мыльницу *(ничего не имею против, просто нужно сразу понимать ограничения техники)*[^phoner],
дальше можно не чи­тать. Речь пойдет о слу­чае, когда техника сама по се­бе в прин­ци­пе не­пло­хая, но условия съемки: фон, ос­ве­ще­ние —
портят всю малину. С дру­гой стороны, если техника реально крутая и *всегда* на пол­ном автомате снимает хорошо, то дальше тоже можно не чи­тать,
просто такая техника и стоит, как, пусть не кры­ло от бо­ин­га, но вполне приличный автомобиль, и использую ее обычно профессионалы, которые
и без ме­ня знают, что и как делать для наи­луч­ше­го результата.

<!--more-->

## Пример

{% image @_src/2023/07/26/IMG_5301.jpg figure left width=320px title="Проявка по умолчанию" %}

Слева (или выше) мы можем видеть фотографию дрозда почти что в ви­де силуэта. Не то, чтобы определить по ней было совсем нельзя, но все же
некоторые сомнения неизбежны. Справа же (или ниже) та же фотография, но скон­вер­ти­ро­ван­ная со сжа­ти­ем кон­т­рас­та — разница очень существенная,
и именно в пла­не распознавания и определения.

{% image @_src/2023/07/26/IMG_5301_01.jpg figure right width=320px title="Проявка со сжатием контраста" %}

Если на ма­лень­ких картинках разница не оче­вид­на, можно по ним клик­нуть — там версия побольше.

При этом не ис­ка­жа­ют­ся цвета, а тем более контуры объектов, рисунок пятен и т.д. и т.п. Да и общая картина меняется незначительно.
По су­ти эффект та­кой же, как будто мы очень умеренно использовали мягкий заполняющий свет при съем­ке.


## Что стоит делать?

*Во-первых*, естественно, но это имеет смысл проговорить, **снимать нужно в RAW** и по воз­мож­нос­ти на хо­ро­шую технику. Но да­же при съем­ке на те­ле­фон
можно а) най­ти настройку или приложение, позволяющие снимать в RAW (не для всех моделей и производителей это возможно, но надо смотреть конкретно);
и б) при­об­рес­ти телеобъектив на при­щеп­ке[^pt], поскольку если птица занимает у вас в кад­ре пару пикселей, это никакой обработкой не спа­сешь.

Ес­ли же никакой возможности снимать в RAW нет, изложенное далее применимо и к фо­то в фор­ма­те JPEG, но с ку­да меньшей эф­фек­тив­нос­тью — просто меньше
информации на вхо­де, могут повылазить шумы или даже искажения. В це­лом, если камера или телефон позволяют только JPEG, то нужно выставить *максимальные*
качество и разрешение, но *без ка­ких-ли­бо улуч­шай­зе­ров*, о ко­то­рых я [еще скажу](#ai) в сле­ду­ю­щем разделе.

{% image @_src/2023/07/26/tone-curve.png figure right width=240px crop="393x393+5+83" title="Модуль «Тональная кривая» с пресетом «Сжатие контраста»" %}

*Во-вторых*, как выше уже сказано, можно использовать **сжатие контраста**. Так это называется в **Dark­tab­le**{:.img-icon-darktable} — это пре­сет
в [мо­ду­ле «Тональная кривая»][curve], и собственно кривая выглядит, как показано на скрин­шо­те справа (или выше). Точно та­кую же кривую можно
использовать и в дру­гих программах для об­ра­бот­ки фотографий.

{:.note.italic}
Строго говоря, дефолтный пресет работает не со­всем так, как на­до — он накладывает кривую на три RGB-ка­на­ла сразу, тогда как в иде­а­ле нужно работать
в прос­т­ран­с­т­ве Lab (или HSL) и применять кривую исключительно к ка­на­лу светлоты, что Darktable вполне умеет, но по­че­му-то пре­сет, идущий в ком­п­лек­те,
работает не так... Впрочем, результат примерно одинаков.

*В-третьих*, нужно использовать **адекватный кроп**. По двум причинам. Пер­вая — это убирание всего лишнего и не име­ю­ще­го отношения к де­лу, при этом
желательно все-та­ки оставить в кад­ре ка­кие-то объекты (ветки, лис­тья/хвою и т.д.), которые позволят более менее прикинуть масштаб (и здесь, конечно,
появляется большая проблема с ле­тя­щи­ми/па­ря­щи­ми птицами на фо­не неба, облаков или просто существенно далеких объектов, но тут уж ничего не по­де­ла­ешь).
Вторая причина для кро­па — это то, что как правило на сайт загружаются фотографии не в ори­ги­наль­ном размере, а приведенные к ка­ко­му-то разумному
разрешению. Я, например, выставляю максимальным размером 2500px по длин­ной стороне[^crop]. И вы­брав кропом сразу интересную область, мы меньше
потеряем деталей при умень­ше­нии.

И *в-чет­вер­тых*, бывают случаи, когда общий контраст сцены не слиш­ком большой, а на­о­бо­рот — слишком маленький, т.е. вся картинка в те­ни. И тог­да нам
нужен другой ин­с­т­ру­мент — **ав­то-уров­ни** (в **Dark­tab­le**{:.img-icon-darktable} это [модуль «Уровни»][levels][^dep] в ре­жи­ме «Авто»). Или прос­то уровни,
где точку черного мы подтягиваем к ле­во­му краю гистограммы, а точку бе­ло­го — к пра­во­му. Опять же такая функциональность присутствует в са­мых разных
программах для об­ра­бот­ки фото. Впрочем, этот инструмент можно и нужно использовать вообще всегда. На кар­тин­ке с кри­вой тоже видно, что в пра­вой части
у нас пустое место, что и будет исправлено ав­то-уров­ня­ми.

Важный момент: уровни применяются *после* кро­па, чтобы растянуть гистограмму именно выбранного изображения, а не всей сцены, где у нас могут быть
участки и более светлые, и более темные, чем в ин­те­ре­су­ю­щем нас фрагменте.

## Чего делать не стоит?

* **Шумоподавление** крадет мелкие детали, тут, я думаю, особых пояснений не тре­бу­ет­ся.

* **Коррекция экспозиции**, которая сдвигает светлоту пикселей целиком вправо или влево. Нам не ну­жно темносерую картинку сделать светлосерой, нам нужно
  вытянуть максимум информации, для че­го служат кривые и уровни, не сдви­гая, а растягивая гистограмму.

* **Любые игры с цве­том**. Сюда относится как банальное дерганье ползунка цветности (saturation), так и более тонкие способы, включая раздельное применение
  кривых и уровней по цве­то­вым каналам. Кривые и уровни применяем или ко всем каналам сразу в RGB-мо­де­ли, или, даже лучше, только к ка­на­лу светлоты (L)
  в цве­то­вых моделях, которые это позволяют.

  {:.small.italic}
  Правда, если говорить об об­ра­бот­ке фотографий вообще, а не кон­к­рет­но для iNa­tu­ra­list, то раздельное применение уровней на RGB-ка­на­лах позволяет
  в не­ко­то­рых случаях[^rgb] проявить мелкие детали более явственно, но итоговые цвета при этом искажаются, что недопустимо при до­ку­мен­ти­ро­ва­нии наблюдений.

{:#ai}
* **AI и улучшайзеры**, всякая вычислительная фотография. Лучше отсутствие деталей, чем детали, дорисованные искусственно. Оставляем улуч­шай­зе­ры для ин­ста­гра­ма.
  Сю­да же, интеллектуальные шу­мо­да­вы, интеллектуальное увеличение и так далее. ИИ может нарисовать что угодно и совершенно безотносительно к дей­с­т­ви­тель­нос­ти.
  Кстати, верхняя картинка к пос­ту (КДПВ) нарисована именно нейросетью чисто для ил­люс­т­ра­ции.

  Тут, кстати, засада в том, что в со­вре­мен­ных телефонах это может быть включено по умол­ча­нию и требовать некоторых усилий для от­клю­че­ния. Что ж, придется
  приложить некоторые усилия. С дру­гой стороны, в не­ко­то­рых телефонах AI-ре­жим означает всего лишь интеллектуальный выбор параметров съемки, что скорее
  хорошо.

## Под вопросом

Некоторые моменты съемки и обработки я бы отнес к спор­ным, от них, наверное, не сто­ит полностью отказываться, но использовать надо осторожно и внимательно.

* **Использование поляризационных фильтров**. С од­ной стороны такие фильтры очень хорошо снижают яркость именно неба на фо­не, гораздо сильнее, чем яркость
  собственно снимаемых объектов. С дру­гой — таки и на объ­ект съемки действуют. Я таким фильтром пользовался, но в ито­ге от не­го отказался. Да, сжатием
  контраста приходится пользоваться чаще, да, небо как правило выбитое и некрасивое, но все-таки значимых деталей остается больше за счет более низкого ISO.

  Ес­ли же у вас света почти всегда более, чем достаточно, и хочется красивого синего не­ба — пользуйтесь.

* **Съемка HDR и прочий автоматический сте­кинг**. Здесь главная проблема в том, что для движущихся объектов это просто не сра­бо­та­ет, а при этом будет потеряна
  возможность снимать быстрыми сериями и даже, возможно, сохранение в RAW. Т.е. погнавшись за расширением доступной информации, мы наоборот — какую-то информацию
  потеряем.

  {:.note.small.italic}
  Ручной сте­кинг по фо­ку­су в мак­ро­съем­ке — это отдельная тема. Дело это нудное и скорее полезное, но очень уж условно полезное. Во-пер­вых, мы получаем заведомо
  искусственный кадр, а во-вто­рых, нужен он для то­го, чтобы одновременно показать в фо­ку­се разные детали, но по идее эти разные детали нужно показывать разными
  кадрами с раз­ных ракурсов. Впрочем, это ка­кие-то совсем теоретические рас­суж­де­ния — я ничего такого на iNa­tu­ra­list ни ра­зу не встре­чал и практически уверен, что
  не встре­чу.

* **Резкость или локальный контраст** при об­ра­бот­ке. Вообще, классическое повышение рез­кос­ти — шар­пинг — мерзость несусветная, но много где включенная
  по умол­ча­нию. При об­ра­бот­ке на ком­пью­те­ре лучше вместо нее использовать локальный контраст. Или не ис­поль­зо­вать ни то­го, ни дру­го­го? Все-та­ки оба метода
  вносят искажения, но вот мне, если честно, лень отключать локальный контраст отдельно для на­блю­де­ний (а для фо­то вообще он мне однозначно нужен).
  Для се­бя я решил, что это искажение достаточно слабое и допустимое, но не пре­тен­дую на аб­со­лют­ную истину.

  Чего точно делать не на­до, так это повышать резкость или локальный контраст сверх дефолтного.

* **Баланс белого**. Как правило, все-та­ки автоматический выбор баланса белого дает приемлемый результат. Кроме того, если ББ не со­всем дикий, то
  на «чи­та­е­мость» фотографии он не вли­я­ет.

## Итого

Давайте все-таки исходить из то­го, что фотография в на­блю­де­ни­ях — это способ представления информации, и **наша за­да­ча — вытянуть максимум имеющейся информации
и представить ее в удо­бо­ва­ри­мом виде**. Любые эстетические соображения не дол­ж­ны противоречить информативности.

* Начинается фотография даже не с мо­мен­та съемки, а с вы­бо­ра техники и **правильной ее настройки**. Свою технику желательно хорошо знать,
  знать ее возможности и ограничения.

* Ручная «проявка» RAW на ком­пью­те­ре дает бо́ль­шие возможности и бо́ль­шую гибкость, чем автоматическая в ка­ме­ре. Если, конечно, немного изучить
  соответствующие программные инструменты.

* Частая проблема фотографий на iNa­tu­ra­list — это неразличимые детали в те­нях. Здесь могут помочь **сжатие контраста кривыми и ав­то-уров­ни**.

* **Искажения цветов и кон­ту­ров — зло. А до­ри­сов­ка того, чего не со­дер­жит­ся в ис­ход­ной фо­то­гра­фии — зло абсолютное.**

Ну, как-то так.


[^obs]: Не бу­ду показывать пальцем, но можно посмотреть в це­лом на [спи­сок наблюдений птиц, нераспознанных за дол­гое время](https://www.inaturalist.org/observations?created_d2=2023-04-30&photos&place_id=139490&quality_grade=needs_id&verifiable=any&iconic_taxa=Aves "Список нераспознанных птиц, загруженных до мая 2023 года"), и там между действительно сложных случаев и безнадежно телефонных кадров легко обнаружить и то, что я имею в ви­ду.

[^phoner]: Хотя я и не понимаю *постоянную* съемку на телефон совершенно неопределяемых кадров. Если это уже хобби, то можно и б/у фотокамеру купить.

[^pt]: Так себе вариант, конечно, эти объективы все мыльные по оп­ре­де­ле­нию, но всяко лучше, чем снимать далеких птиц на ши­ро­кий телефонный угол.

[^news]: Я планирую этот пост с не­боль­ши­ми сокращениями выложить также [в сво­ем журнале на iNa­tu­ra­list](https://www.inaturalist.org/journal/shikhalev), поэтому проговариваю некоторые вещи, о ко­то­рых уже писал, или полагаю общеизвестными для лю­би­те­лей *фотографии как таковой*, однако которые явно (судя по на­блю­де­ни­ям) неизвестны тамошней аудитории.

[^crop]: И кадрирую обычно в квад­рат. Как выяснилось, это наиболее удобный формат для про­смот­ра не толь­ко на те­ле­фо­нах, но и на боль­ших мониторах с вы­со­ким разрешением.

[^dep]: В вер­сии Dark­tab­​le 4.4.1 этот модуль объявлен устаревшим, однако адекватной замены ему не пред­ло­же­но — предлагаемый «Уровни RGB» как раз режима «Авто» и не име­ет. Впрочем, судя по до­ку­мен­та­ции, в но­вей­шей версии 4.4.2 модуль «Уровни» восстановили в пра­вах...

[^rgb]: См. мой пост [«Новый модуль Darktable — „Уровни RGB“» от 17.01.2020][rgb-levels].

[inat]: https://www.inaturalist.org/ "iNaturalist"

[curve]: https://docs.darktable.org/usermanual/4.2/en/module-reference/processing-modules/tone-curve/ "Модуль «Тональная кривая» [en]"

[levels]: https://docs.darktable.org/usermanual/4.2/en/module-reference/processing-modules/levels/ "Модуль «Уровни» [en]"

[rgb-levels]: {% link _posts/photo/2020/2020-01-17-darktable-rgb-levels.md %} "Новый модуль Darktable — «Уровни RGB»"
